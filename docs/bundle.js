(()=>{"use strict";var t={769:(t,i)=>{Object.defineProperty(i,"__esModule",{value:!0});class s{constructor(t=[]){this.blocks=t}detectCollision(t){for(let i=0;i<this.blocks.length;i++)if(this.blocks[i].position.x==t.x&&this.blocks[i].position.y==t.y)return!0;return!1}detectCollisionWithSprite(t){for(let i=0;i<this.blocks.length;i++)for(let s=0;s<t.blocks.length;s++)if(this.blocks[i].position.x==t.blocks[s].position.x&&this.blocks[i].position.y==t.blocks[s].position.y)return!0;return!1}detectCollisionWithBlock(t){for(let i=0;i<this.blocks.length;i++)if(this.blocks[i].position.x==t.position.x&&this.blocks[i].position.y==t.position.y)return!0;return!1}}class e extends s{constructor(t,i){super([{position:t,color:i}])}get block(){return this.blocks[0]}}class o extends s{constructor(t,i){let s=[];for(let e=0;e<i;e++)s.push({position:{x:t.x+e,y:t.y+e},color:"black"});super(s)}eat(t){this.blocks.push({...t,color:"black"})}move(t,i){this.blocks=[...this.blocks.slice(1),{position:{x:this.headBlock.position.x+t,y:this.headBlock.position.y+i},color:"black"}]}moveTo(t,i){this.blocks=[...this.blocks.slice(1),{position:{x:t,y:i},color:"black"}]}detectCollisionWithSelf({x:t,y:i}){return this.blocks.slice(1).some((s=>s.position.x==t&&s.position.y==i))}get headBlock(){return this.blocks[this.blocks.length-1]}}class h extends e{constructor(t,i="red"){super(t,i)}}class n extends e{constructor(t,i="#666666"){super(t,i)}}i.default=class{constructor(){this.cellSize=20,this.cellsX=40,this.cellsY=40,this.width=this.cellsX*this.cellSize,this.height=this.cellsY*this.cellSize,this.isRunning=!0,this.frameCount=0,this.fps=20,this.fpsInterval=1e3/this.fps,this.apples=[],this.numApples=10,this.traps=[],this.numTraps=5,this.gameStatus="running",this.scale=1,this.setupDimensions(),this.setupButtons(),this.startGame()}startGame(){this.lastTime=window.performance.now(),this.startTime=this.lastTime,this.buildSprites(),window.addEventListener("keydown",this.onKeyDown.bind(this),!1),window.requestAnimationFrame(this.runGameLoop.bind(this)),this.isRunning=!0}buildSprites(){this.setSnakePosition(),this.setApplePositions(),this.setTrapPositions()}setupDimensions(){if(this.canvas=document.createElement("Canvas"),this.context.lineWidth=2,document.body.append(this.canvas),this.cellsX*this.cellSize*this.scale+1>window.innerHeight){const t=window.innerHeight;this.cellSize=t/(this.scale*this.cellsY)-1,this.width=this.cellsX*this.cellSize,this.height=this.cellsY*this.cellSize}this.canvas.style.width=this.width+"px",this.canvas.style.height=this.height+"px",this.canvas.width=this.width,this.canvas.height=this.height}setupButtons(){window.addEventListener("load",(()=>{this.startOverButton=document.createElement("button"),this.startOverButton.innerHTML="Start Over",this.startOverButton.addEventListener("click",this.onStartOverClick.bind(this)),this.toggleStartOverButton(!1),document.getElementById("controls").appendChild(this.startOverButton)}))}onStartOverClick(){this.apples=[],this.traps=[],this.player=null,this.buildSprites(),this.isRunning=!0,this.gameStatus="running",window.requestAnimationFrame(this.runGameLoop.bind(this))}toggleStartOverButton(t){this.startOverButton.style.opacity=t?"1":"0"}onKeyDown(t){switch(t.key){case"Escape":this.isRunning=!1;break;case"a":this.direction="Left";break;case"s":this.direction="Down";break;case"d":this.direction="Right";break;case"w":this.direction="Up"}}moveInDirection(){switch(this.direction){case"Up":this.movePlayer(0,-1);break;case"Down":this.movePlayer(0,1);break;case"Left":this.movePlayer(-1,0);break;case"Right":this.movePlayer(1,0)}}movePlayer(t,i){const s=this.player.headBlock.position.x+t,e=this.player.headBlock.position.y+i;this.checkState({x:s,y:e})&&(s<0?this.player.moveTo(this.cellsX-1,e):s>this.cellsX-1?this.player.moveTo(0,e):e<0?this.player.moveTo(s,this.cellsY-1):e>this.cellsY-1?this.player.moveTo(s,0):this.player.move(t,i))}runGameLoop(t){if(!this.isRunning)return void this.toggleStartOverButton(!0);this.animationFrameRequestId=window.requestAnimationFrame(this.runGameLoop.bind(this));const i=t,s=i-this.lastTime;if(s>this.fpsInterval){this.lastTime=i-s%this.fpsInterval;const t=i-this.startTime;this.moveInDirection(),this.paint(),this.drawFPS(t),this.showGameMessage()}}checkState(t){const{x:i,y:s}=t;if(this.playerIsCollidedWithTrap({x:i,y:s}))return this.lostGame(),!1;let e=this.playerIsCollidedWithApple({x:i,y:s});if(e){const t=this.apples.indexOf(e);return this.player.eat(e.block),this.apples=[...this.apples.slice(0,t),...this.apples.slice(t+1)],!1}return this.player.detectCollisionWithSelf(t)?(console.log({position:t,headBlock:this.player.headBlock.position}),this.lostGame(),!1):0!=this.apples.length||(this.isRunning=!1,this.gameStatus="won",window.cancelAnimationFrame(this.animationFrameRequestId),!1)}lostGame(){this.isRunning=!1,this.gameStatus="lost",window.cancelAnimationFrame(this.animationFrameRequestId)}playerIsCollidedWithTrap({x:t,y:i}){return this.traps.some((s=>s.detectCollision({x:t,y:i})))}playerIsCollidedWithApple({x:t,y:i}){return this.apples.find((s=>s.detectCollision({x:t,y:i})))}get context(){return this.canvas.getContext("2d")}paint(){this.clearScreen(),this.drawGrid(0,0,this.width,this.height),this.drawSprite(this.player),this.apples.forEach((t=>this.drawSprite(t))),this.traps.forEach((t=>this.drawSprite(t)))}clearScreen(){this.context.fillStyle="white",this.context.clearRect(0,0,this.width,this.height)}drawSprite(t){t.blocks.forEach((t=>{this.drawBlock(t.position.x,t.position.y,t.color)}))}drawBlock(t,i,s){this.context.fillStyle=s,this.context.fillRect(t*this.cellSize,i*this.cellSize,this.cellSize,this.cellSize)}drawGrid(t,i,s,e){this.context.strokeStyle="#CCCCCC";for(let t=0;t<=s;t+=this.cellSize)this.context.beginPath(),this.context.moveTo(t,i),this.context.lineTo(t,e),this.context.stroke();for(let i=0;i<=e;i+=this.cellSize)this.context.beginPath(),this.context.moveTo(t,i),this.context.lineTo(s,i),this.context.stroke()}showGameMessage(){switch(this.gameStatus){case"lost":this.drawTextAtMiddle("Try again");break;case"won":this.drawTextAtMiddle("You won!")}}drawFPS(t){const i=Math.round(1e3/(t/++this.frameCount)*100)/100;this.drawTextAtBottomRight(`FPS: ${i.toString()}`)}drawStrokeText(t,i,s){this.context.strokeStyle="white";const e=this.context.lineWidth;this.context.lineWidth=4,this.context.strokeText(t,i,s),this.context.fillStyle="black",this.context.fillText(t,i,s),this.context.lineWidth=e}drawTextAtMiddle(t){this.context.font="36px sans-serif";const i=this.context.measureText(t);this.drawStrokeText(t,this.width/2-i.width/2,this.height/2-i.actualBoundingBoxAscent/2)}drawTextAtBottomRight(t){this.context.font="12px sans-serif";const i=this.context.measureText(t);this.drawText(t,this.width-i.width-1,this.height-2)}drawText(t,i,s){this.context.fillStyle="black",this.context.fillText(t,i,s,this.width)}setSnakePosition(){const[t,i]=[Math.floor(this.cellsX/2),Math.floor(this.cellsY/2)];this.player=new o({x:t,y:i},6)}getRandomXY(){return{x:Math.floor(Math.random()*this.cellsX),y:Math.floor(Math.random()*this.cellsY)}}setApplePositions(){for(let t=0;t<this.numApples;t++){let t;for(;!t||t.detectCollisionWithSprite(this.player);){const{x:i,y:s}=this.getRandomXY();t=new h({x:i,y:s})}this.apples.push(t)}}setTrapPositions(){for(let t=0;t<this.numTraps;t++){let t;for(;!t||t.detectCollisionWithSprite(this.player)||this.apples.some((i=>i.detectCollisionWithSprite(t)));){const{x:i,y:s}=this.getRandomXY();t=new n({x:i,y:s})}this.traps.push(t)}}}},607:function(t,i,s){var e=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(i,"__esModule",{value:!0}),(new(e(s(769)).default)).runGameLoop()}},i={};!function s(e){if(i[e])return i[e].exports;var o=i[e]={exports:{}};return t[e].call(o.exports,o,o.exports,s),o.exports}(607)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zbmFrZS10eXBlc2NyaXB0Ly4vc3JjL2dhbWUudHMiLCJ3ZWJwYWNrOi8vc25ha2UtdHlwZXNjcmlwdC8uL3NyYy9pbmRleC50cyIsIndlYnBhY2s6Ly9zbmFrZS10eXBlc2NyaXB0L3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovL3NuYWtlLXR5cGVzY3JpcHQvd2VicGFjay9zdGFydHVwIl0sIm5hbWVzIjpbIlNwcml0ZSIsImJsb2NrcyIsInBvc2l0aW9uIiwiaSIsInRoaXMiLCJsZW5ndGgiLCJ4IiwieSIsInNwcml0ZSIsImoiLCJibG9jayIsIlNpbmd1bGFyU3ByaXRlIiwiY29sb3IiLCJzdXBlciIsIlBsYXllciIsInN0YXJ0UG9zaXRpb24iLCJudW1CbG9ja3MiLCJwdXNoIiwieE9mZnNldCIsInlPZmZzZXQiLCJzbGljZSIsImhlYWRCbG9jayIsInNvbWUiLCJBcHBsZSIsIlRyYXAiLCJjZWxsU2l6ZSIsImNlbGxzWCIsImNlbGxzWSIsIndpZHRoIiwiaGVpZ2h0IiwiaXNSdW5uaW5nIiwiZnJhbWVDb3VudCIsImZwcyIsImZwc0ludGVydmFsIiwiYXBwbGVzIiwibnVtQXBwbGVzIiwidHJhcHMiLCJudW1UcmFwcyIsImdhbWVTdGF0dXMiLCJzY2FsZSIsInNldHVwRGltZW5zaW9ucyIsInNldHVwQnV0dG9ucyIsInN0YXJ0R2FtZSIsImxhc3RUaW1lIiwid2luZG93IiwicGVyZm9ybWFuY2UiLCJub3ciLCJzdGFydFRpbWUiLCJidWlsZFNwcml0ZXMiLCJhZGRFdmVudExpc3RlbmVyIiwib25LZXlEb3duIiwiYmluZCIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsInJ1bkdhbWVMb29wIiwic2V0U25ha2VQb3NpdGlvbiIsInNldEFwcGxlUG9zaXRpb25zIiwic2V0VHJhcFBvc2l0aW9ucyIsImNhbnZhcyIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsImNvbnRleHQiLCJsaW5lV2lkdGgiLCJib2R5IiwiYXBwZW5kIiwiaW5uZXJIZWlnaHQiLCJzdHlsZSIsInN0YXJ0T3ZlckJ1dHRvbiIsImlubmVySFRNTCIsIm9uU3RhcnRPdmVyQ2xpY2siLCJ0b2dnbGVTdGFydE92ZXJCdXR0b24iLCJnZXRFbGVtZW50QnlJZCIsImFwcGVuZENoaWxkIiwicGxheWVyIiwic2hvdyIsIm9wYWNpdHkiLCJldnQiLCJrZXkiLCJkaXJlY3Rpb24iLCJtb3ZlUGxheWVyIiwibmV3WCIsIm5ld1kiLCJjaGVja1N0YXRlIiwibW92ZVRvIiwibW92ZSIsIm5ld1RpbWUiLCJhbmltYXRpb25GcmFtZVJlcXVlc3RJZCIsInRpbWVFbGFwc2VkIiwidGltZVNpbmNlU3RhcnQiLCJtb3ZlSW5EaXJlY3Rpb24iLCJwYWludCIsImRyYXdGUFMiLCJzaG93R2FtZU1lc3NhZ2UiLCJwbGF5ZXJJc0NvbGxpZGVkV2l0aFRyYXAiLCJsb3N0R2FtZSIsImNvbGxpZGVkQXBwbGUiLCJwbGF5ZXJJc0NvbGxpZGVkV2l0aEFwcGxlIiwiaWR4IiwiaW5kZXhPZiIsImVhdCIsImRldGVjdENvbGxpc2lvbldpdGhTZWxmIiwiY29uc29sZSIsImxvZyIsImNhbmNlbEFuaW1hdGlvbkZyYW1lIiwidHJhcCIsImRldGVjdENvbGxpc2lvbiIsImZpbmQiLCJhcHBsZSIsImdldENvbnRleHQiLCJjbGVhclNjcmVlbiIsImRyYXdHcmlkIiwiZHJhd1Nwcml0ZSIsImZvckVhY2giLCJmaWxsU3R5bGUiLCJjbGVhclJlY3QiLCJkcmF3QmxvY2siLCJmaWxsUmVjdCIsInN0cm9rZVN0eWxlIiwiYmVnaW5QYXRoIiwibGluZVRvIiwic3Ryb2tlIiwiZHJhd1RleHRBdE1pZGRsZSIsImN1cnJlbnRGcHMiLCJNYXRoIiwicm91bmQiLCJkcmF3VGV4dEF0Qm90dG9tUmlnaHQiLCJ0b1N0cmluZyIsInRleHQiLCJwcmV2TGluZVdpZHRoIiwic3Ryb2tlVGV4dCIsImZpbGxUZXh0IiwiZm9udCIsInRleHRNZXRyaWNzIiwibWVhc3VyZVRleHQiLCJkcmF3U3Ryb2tlVGV4dCIsImFjdHVhbEJvdW5kaW5nQm94QXNjZW50IiwiZHJhd1RleHQiLCJtaWRkbGVYIiwibWlkZGxlWSIsImZsb29yIiwicmFuZG9tIiwiZGV0ZWN0Q29sbGlzaW9uV2l0aFNwcml0ZSIsImdldFJhbmRvbVhZIiwiX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiZXhwb3J0cyIsIm1vZHVsZSIsIl9fd2VicGFja19tb2R1bGVzX18iLCJjYWxsIl0sIm1hcHBpbmdzIjoidUZBU0EsTUFBTUEsRUFDSixZQUFtQkMsRUFBa0IsSUFBbEIsS0FBQUEsU0FFbkIsZ0JBQWdCQyxHQUNkLElBQUssSUFBSUMsRUFBSSxFQUFHQSxFQUFJQyxLQUFLSCxPQUFPSSxPQUFRRixJQUN0QyxHQUNFQyxLQUFLSCxPQUFPRSxHQUFHRCxTQUFTSSxHQUFLSixFQUFTSSxHQUN0Q0YsS0FBS0gsT0FBT0UsR0FBR0QsU0FBU0ssR0FBS0wsRUFBU0ssRUFFdEMsT0FBTyxFQUdYLE9BQU8sRUFHVCwwQkFBMEJDLEdBQ3hCLElBQUssSUFBSUwsRUFBSSxFQUFHQSxFQUFJQyxLQUFLSCxPQUFPSSxPQUFRRixJQUN0QyxJQUFLLElBQUlNLEVBQUksRUFBR0EsRUFBSUQsRUFBT1AsT0FBT0ksT0FBUUksSUFDeEMsR0FDRUwsS0FBS0gsT0FBT0UsR0FBR0QsU0FBU0ksR0FBS0UsRUFBT1AsT0FBT1EsR0FBR1AsU0FBU0ksR0FDdkRGLEtBQUtILE9BQU9FLEdBQUdELFNBQVNLLEdBQUtDLEVBQU9QLE9BQU9RLEdBQUdQLFNBQVNLLEVBRXZELE9BQU8sRUFJYixPQUFPLEVBR1QseUJBQXlCRyxHQUN2QixJQUFLLElBQUlQLEVBQUksRUFBR0EsRUFBSUMsS0FBS0gsT0FBT0ksT0FBUUYsSUFDdEMsR0FDRUMsS0FBS0gsT0FBT0UsR0FBR0QsU0FBU0ksR0FBS0ksRUFBTVIsU0FBU0ksR0FDNUNGLEtBQUtILE9BQU9FLEdBQUdELFNBQVNLLEdBQUtHLEVBQU1SLFNBQVNLLEVBRTVDLE9BQU8sRUFH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LElBT1YsT0FIQUUsRUFBb0JILEdBQVVJLEtBQUtGLEVBQU9ELFFBQVNDLEVBQVFBLEVBQU9ELFFBQVNGLEdBR3BFRyxFQUFPRCxRQ2pCZkYsQ0FBb0IsTSIsImZpbGUiOiJidW5kbGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbnRlcmZhY2UgUG9zaXRpb24ge1xuICB4OiBudW1iZXI7XG4gIHk6IG51bWJlcjtcbn1cbmludGVyZmFjZSBCbG9jayB7XG4gIHBvc2l0aW9uOiBQb3NpdGlvbjtcbiAgY29sb3I/OiBzdHJpbmc7XG59XG5cbmNsYXNzIFNwcml0ZSB7XG4gIGNvbnN0cnVjdG9yKHB1YmxpYyBibG9ja3M6IEJsb2NrW10gPSBbXSkge31cblxuICBkZXRlY3RDb2xsaXNpb24ocG9zaXRpb246IFBvc2l0aW9uKTogYm9vbGVhbiB7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmJsb2Nrcy5sZW5ndGg7IGkrKykge1xuICAgICAgaWYgKFxuICAgICAgICB0aGlzLmJsb2Nrc1tpXS5wb3NpdGlvbi54ID09IHBvc2l0aW9uLnggJiZcbiAgICAgICAgdGhpcy5ibG9ja3NbaV0ucG9zaXRpb24ueSA9PSBwb3NpdGlvbi55XG4gICAgICApIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIGRldGVjdENvbGxpc2lvbldpdGhTcHJpdGUoc3ByaXRlOiBTcHJpdGUpOiBib29sZWFuIHtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuYmxvY2tzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHNwcml0ZS5ibG9ja3MubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgaWYgKFxuICAgICAgICAgIHRoaXMuYmxvY2tzW2ldLnBvc2l0aW9uLnggPT0gc3ByaXRlLmJsb2Nrc1tqXS5wb3NpdGlvbi54ICYmXG4gICAgICAgICAgdGhpcy5ibG9ja3NbaV0ucG9zaXRpb24ueSA9PSBzcHJpdGUuYmxvY2tzW2pdLnBvc2l0aW9uLnlcbiAgICAgICAgKSB7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgZGV0ZWN0Q29sbGlzaW9uV2l0aEJsb2NrKGJsb2NrOiBCbG9jayk6IGJvb2xlYW4ge1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5ibG9ja3MubGVuZ3RoOyBpKyspIHtcbiAgICAgIGlmIChcbiAgICAgICAgdGhpcy5ibG9ja3NbaV0ucG9zaXRpb24ueCA9PSBibG9jay5wb3NpdGlvbi54ICYmXG4gICAgICAgIHRoaXMuYmxvY2tzW2ldLnBvc2l0aW9uLnkgPT0gYmxvY2sucG9zaXRpb24ueVxuICAgICAgKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbn1cblxuY2xhc3MgU2luZ3VsYXJTcHJpdGUgZXh0ZW5kcyBTcHJpdGUge1xuICBjb25zdHJ1Y3Rvcihwb3NpdGlvbjogUG9zaXRpb24sIGNvbG9yOiBzdHJpbmcpIHtcbiAgICBzdXBlcihbeyBwb3NpdGlvbiwgY29sb3IgfV0pO1xuICB9XG5cbiAgZ2V0IGJsb2NrKCkge1xuICAgIHJldHVybiB0aGlzLmJsb2Nrc1swXTtcbiAgfVxufVxuXG5jbGFzcyBQbGF5ZXIgZXh0ZW5kcyBTcHJpdGUge1xuICBjb25zdHJ1Y3RvcihzdGFydFBvc2l0aW9uOiBQb3NpdGlvbiwgbnVtQmxvY2tzOiBudW1iZXIpIHtcbiAgICBsZXQgYmxvY2tzOiBCbG9ja1tdID0gW107XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1CbG9ja3M7IGkrKykge1xuICAgICAgYmxvY2tzLnB1c2goe1xuICAgICAgICBwb3NpdGlvbjogeyB4OiBzdGFydFBvc2l0aW9uLnggKyBpLCB5OiBzdGFydFBvc2l0aW9uLnkgKyBpIH0sXG4gICAgICAgIGNvbG9yOiBcImJsYWNrXCIsXG4gICAgICB9KTtcbiAgICB9XG4gICAgc3VwZXIoYmxvY2tzKTtcbiAgfVxuXG4gIGVhdChibG9jazogQmxvY2spIHtcbiAgICB0aGlzLmJsb2Nrcy5wdXNoKHsgLi4uYmxvY2ssIGNvbG9yOiBcImJsYWNrXCIgfSk7XG4gIH1cblxuICBtb3ZlKHhPZmZzZXQ6IG51bWJlciwgeU9mZnNldDogbnVtYmVyKSB7XG4gICAgdGhpcy5ibG9ja3MgPSBbXG4gICAgICAuLi50aGlzLmJsb2Nrcy5zbGljZSgxKSxcbiAgICAgIHtcbiAgICAgICAgcG9zaXRpb246IHtcbiAgICAgICAgICB4OiB0aGlzLmhlYWRCbG9jay5wb3NpdGlvbi54ICsgeE9mZnNldCxcbiAgICAgICAgICB5OiB0aGlzLmhlYWRCbG9jay5wb3NpdGlvbi55ICsgeU9mZnNldCxcbiAgICAgICAgfSxcbiAgICAgICAgY29sb3I6IFwiYmxhY2tcIixcbiAgICAgIH0sXG4gICAgXTtcbiAgfVxuXG4gIG1vdmVUbyh4OiBudW1iZXIsIHk6IG51bWJlcikge1xuICAgIHRoaXMuYmxvY2tzID0gW1xuICAgICAgLi4udGhpcy5ibG9ja3Muc2xpY2UoMSksXG4gICAgICB7XG4gICAgICAgIHBvc2l0aW9uOiB7IHgsIHkgfSxcbiAgICAgICAgY29sb3I6IFwiYmxhY2tcIixcbiAgICAgIH0sXG4gICAgXTtcbiAgfVxuXG4gIGRldGVjdENvbGxpc2lvbldpdGhTZWxmKHsgeCwgeSB9KSB7XG4gICAgcmV0dXJuIHRoaXMuYmxvY2tzLnNsaWNlKDEpLnNvbWUoKGJsb2NrKSA9PiB7XG4gICAgICByZXR1cm4gYmxvY2sucG9zaXRpb24ueCA9PSB4ICYmIGJsb2NrLnBvc2l0aW9uLnkgPT0geTtcbiAgICB9KTtcbiAgfVxuXG4gIGdldCBoZWFkQmxvY2soKTogQmxvY2sge1xuICAgIHJldHVybiB0aGlzLmJsb2Nrc1t0aGlzLmJsb2Nrcy5sZW5ndGggLSAxXTtcbiAgfVxufVxuXG5jbGFzcyBBcHBsZSBleHRlbmRzIFNpbmd1bGFyU3ByaXRlIHtcbiAgY29uc3RydWN0b3IocG9zaXRpb246IFBvc2l0aW9uLCBjb2xvciA9IFwicmVkXCIpIHtcbiAgICBzdXBlcihwb3NpdGlvbiwgY29sb3IpO1xuICB9XG59XG5cbmNsYXNzIFRyYXAgZXh0ZW5kcyBTaW5ndWxhclNwcml0ZSB7XG4gIGNvbnN0cnVjdG9yKHBvc2l0aW9uOiBQb3NpdGlvbiwgY29sb3IgPSBcIiM2NjY2NjZcIikge1xuICAgIHN1cGVyKHBvc2l0aW9uLCBjb2xvcik7XG4gIH1cbn1cblxuY2xhc3MgR2FtZSB7XG4gIHByaXZhdGUgY2FudmFzOiBIVE1MQ2FudmFzRWxlbWVudDtcbiAgcHJpdmF0ZSBjZWxsU2l6ZSA9IDIwO1xuICBwcml2YXRlIGNlbGxzWCA9IDQwO1xuICBwcml2YXRlIGNlbGxzWSA9IDQwO1xuICBwcml2YXRlIHdpZHRoID0gdGhpcy5jZWxsc1ggKiB0aGlzLmNlbGxTaXplO1xuICBwcml2YXRlIGhlaWdodCA9IHRoaXMuY2VsbHNZICogdGhpcy5jZWxsU2l6ZTtcbiAgcHJpdmF0ZSBpc1J1bm5pbmcgPSB0cnVlO1xuICBwcml2YXRlIHBsYXllcjogUGxheWVyO1xuICBwcml2YXRlIGxhc3RUaW1lOiBudW1iZXI7XG4gIHByaXZhdGUgc3RhcnRUaW1lOiBudW1iZXI7XG4gIHByaXZhdGUgZnJhbWVDb3VudCA9IDA7XG4gIHByaXZhdGUgZGlyZWN0aW9uOiBcIlVwXCIgfCBcIkRvd25cIiB8IFwiUmlnaHRcIiB8IFwiTGVmdFwiO1xuICBwcml2YXRlIGZwcyA9IDIwO1xuICBwcml2YXRlIGZwc0ludGVydmFsID0gMTAwMCAvIHRoaXMuZnBzO1xuICBwcml2YXRlIGFwcGxlczogQXBwbGVbXSA9IFtdO1xuICBwcml2YXRlIG51bUFwcGxlcyA9IDEwO1xuICBwcml2YXRlIHRyYXBzOiBUcmFwW10gPSBbXTtcbiAgcHJpdmF0ZSBudW1UcmFwcyA9IDU7XG4gIHByaXZhdGUgZ2FtZVN0YXR1cyA9IFwicnVubmluZ1wiO1xuICBwcml2YXRlIGFuaW1hdGlvbkZyYW1lUmVxdWVzdElkOiBudW1iZXI7XG4gIHByaXZhdGUgc2NhbGUgPSAxO1xuICBwcml2YXRlIHN0YXJ0T3ZlckJ1dHRvbjogSFRNTEJ1dHRvbkVsZW1lbnQ7XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5zZXR1cERpbWVuc2lvbnMoKTtcblxuICAgIHRoaXMuc2V0dXBCdXR0b25zKCk7XG4gICAgdGhpcy5zdGFydEdhbWUoKTtcbiAgfVxuXG4gIHN0YXJ0R2FtZSgpIHtcbiAgICB0aGlzLmxhc3RUaW1lID0gd2luZG93LnBlcmZvcm1hbmNlLm5vdygpO1xuICAgIHRoaXMuc3RhcnRUaW1lID0gdGhpcy5sYXN0VGltZTtcblxuICAgIHRoaXMuYnVpbGRTcHJpdGVzKCk7XG5cbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgdGhpcy5vbktleURvd24uYmluZCh0aGlzKSwgZmFsc2UpO1xuICAgIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUodGhpcy5ydW5HYW1lTG9vcC5iaW5kKHRoaXMpKTtcblxuICAgIHRoaXMuaXNSdW5uaW5nID0gdHJ1ZTtcbiAgfVxuXG4gIGJ1aWxkU3ByaXRlcygpIHtcbiAgICB0aGlzLnNldFNuYWtlUG9zaXRpb24oKTtcbiAgICB0aGlzLnNldEFwcGxlUG9zaXRpb25zKCk7XG4gICAgdGhpcy5zZXRUcmFwUG9zaXRpb25zKCk7XG4gIH1cblxuICBzZXR1cERpbWVuc2lvbnMoKSB7XG4gICAgdGhpcy5jYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiQ2FudmFzXCIpIGFzIEhUTUxDYW52YXNFbGVtZW50O1xuICAgIHRoaXMuY29udGV4dC5saW5lV2lkdGggPSAyO1xuICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kKHRoaXMuY2FudmFzKTtcblxuICAgIGlmICh0aGlzLmNlbGxzWCAqIHRoaXMuY2VsbFNpemUgKiB0aGlzLnNjYWxlICsgMSA+IHdpbmRvdy5pbm5lckhlaWdodCkge1xuICAgICAgY29uc3QgaGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0O1xuICAgICAgdGhpcy5jZWxsU2l6ZSA9IGhlaWdodCAvICh0aGlzLnNjYWxlICogdGhpcy5jZWxsc1kpIC0gMTtcbiAgICAgIHRoaXMud2lkdGggPSB0aGlzLmNlbGxzWCAqIHRoaXMuY2VsbFNpemU7XG4gICAgICB0aGlzLmhlaWdodCA9IHRoaXMuY2VsbHNZICogdGhpcy5jZWxsU2l6ZTtcbiAgICB9XG5cbiAgICB0aGlzLmNhbnZhcy5zdHlsZS53aWR0aCA9IHRoaXMud2lkdGggKyBcInB4XCI7XG4gICAgdGhpcy5jYW52YXMuc3R5bGUuaGVpZ2h0ID0gdGhpcy5oZWlnaHQgKyBcInB4XCI7XG5cbiAgICB0aGlzLmNhbnZhcy53aWR0aCA9IHRoaXMud2lkdGg7XG4gICAgdGhpcy5jYW52YXMuaGVpZ2h0ID0gdGhpcy5oZWlnaHQ7XG4gIH1cblxuICBzZXR1cEJ1dHRvbnMoKSB7XG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJsb2FkXCIsICgpID0+IHtcbiAgICAgIHRoaXMuc3RhcnRPdmVyQnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiKTtcbiAgICAgIHRoaXMuc3RhcnRPdmVyQnV0dG9uLmlubmVySFRNTCA9IFwiU3RhcnQgT3ZlclwiO1xuICAgICAgdGhpcy5zdGFydE92ZXJCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcbiAgICAgICAgXCJjbGlja1wiLFxuICAgICAgICB0aGlzLm9uU3RhcnRPdmVyQ2xpY2suYmluZCh0aGlzKSxcbiAgICAgICk7XG4gICAgICB0aGlzLnRvZ2dsZVN0YXJ0T3ZlckJ1dHRvbihmYWxzZSk7XG4gICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImNvbnRyb2xzXCIpLmFwcGVuZENoaWxkKHRoaXMuc3RhcnRPdmVyQnV0dG9uKTtcbiAgICB9KTtcbiAgfVxuXG4gIG9uU3RhcnRPdmVyQ2xpY2soKSB7XG4gICAgdGhpcy5hcHBsZXMgPSBbXTtcbiAgICB0aGlzLnRyYXBzID0gW107XG4gICAgdGhpcy5wbGF5ZXIgPSBudWxsO1xuXG4gICAgdGhpcy5idWlsZFNwcml0ZXMoKTtcbiAgICB0aGlzLmlzUnVubmluZyA9IHRydWU7XG4gICAgdGhpcy5nYW1lU3RhdHVzID0gXCJydW5uaW5nXCI7XG4gICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSh0aGlzLnJ1bkdhbWVMb29wLmJpbmQodGhpcykpO1xuICB9XG5cbiAgdG9nZ2xlU3RhcnRPdmVyQnV0dG9uKHNob3c6IGJvb2xlYW4pIHtcbiAgICB0aGlzLnN0YXJ0T3ZlckJ1dHRvbi5zdHlsZS5vcGFjaXR5ID0gc2hvdyA/IFwiMVwiIDogXCIwXCI7XG4gIH1cblxuICBvbktleURvd24oZXZ0OiBLZXlib2FyZEV2ZW50KSB7XG4gICAgc3dpdGNoIChldnQua2V5KSB7XG4gICAgICBjYXNlIFwiRXNjYXBlXCI6XG4gICAgICAgIHRoaXMuaXNSdW5uaW5nID0gZmFsc2U7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcImFcIjpcbiAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSBcIkxlZnRcIjtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwic1wiOlxuICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IFwiRG93blwiO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJkXCI6XG4gICAgICAgIHRoaXMuZGlyZWN0aW9uID0gXCJSaWdodFwiO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJ3XCI6XG4gICAgICAgIHRoaXMuZGlyZWN0aW9uID0gXCJVcFwiO1xuICAgICAgICBicmVhaztcbiAgICB9XG4gIH1cblxuICBtb3ZlSW5EaXJlY3Rpb24oKSB7XG4gICAgc3dpdGNoICh0aGlzLmRpcmVjdGlvbikge1xuICAgICAgY2FzZSBcIlVwXCI6XG4gICAgICAgIHRoaXMubW92ZVBsYXllcigwLCAtMSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcIkRvd25cIjpcbiAgICAgICAgdGhpcy5tb3ZlUGxheWVyKDAsIDEpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJMZWZ0XCI6XG4gICAgICAgIHRoaXMubW92ZVBsYXllcigtMSwgMCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcIlJpZ2h0XCI6XG4gICAgICAgIHRoaXMubW92ZVBsYXllcigxLCAwKTtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICB9XG5cbiAgbW92ZVBsYXllcih4T2Zmc2V0OiBudW1iZXIsIHlPZmZzZXQ6IG51bWJlcikge1xuICAgIGNvbnN0IG5ld1ggPSB0aGlzLnBsYXllci5oZWFkQmxvY2sucG9zaXRpb24ueCArIHhPZmZzZXQ7XG4gICAgY29uc3QgbmV3WSA9IHRoaXMucGxheWVyLmhlYWRCbG9jay5wb3NpdGlvbi55ICsgeU9mZnNldDtcblxuICAgIGlmICghdGhpcy5jaGVja1N0YXRlKHsgeDogbmV3WCwgeTogbmV3WSB9KSkgcmV0dXJuO1xuXG4gICAgaWYgKG5ld1ggPCAwKSB7XG4gICAgICB0aGlzLnBsYXllci5tb3ZlVG8odGhpcy5jZWxsc1ggLSAxLCBuZXdZKTtcbiAgICB9IGVsc2UgaWYgKG5ld1ggPiB0aGlzLmNlbGxzWCAtIDEpIHtcbiAgICAgIHRoaXMucGxheWVyLm1vdmVUbygwLCBuZXdZKTtcbiAgICB9IGVsc2UgaWYgKG5ld1kgPCAwKSB7XG4gICAgICB0aGlzLnBsYXllci5tb3ZlVG8obmV3WCwgdGhpcy5jZWxsc1kgLSAxKTtcbiAgICB9IGVsc2UgaWYgKG5ld1kgPiB0aGlzLmNlbGxzWSAtIDEpIHtcbiAgICAgIHRoaXMucGxheWVyLm1vdmVUbyhuZXdYLCAwKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5wbGF5ZXIubW92ZSh4T2Zmc2V0LCB5T2Zmc2V0KTtcbiAgICB9XG4gIH1cblxuICBydW5HYW1lTG9vcChuZXdUaW1lPzogbnVtYmVyKSB7XG4gICAgaWYgKCF0aGlzLmlzUnVubmluZykge1xuICAgICAgdGhpcy50b2dnbGVTdGFydE92ZXJCdXR0b24odHJ1ZSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5hbmltYXRpb25GcmFtZVJlcXVlc3RJZCA9IHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUoXG4gICAgICB0aGlzLnJ1bkdhbWVMb29wLmJpbmQodGhpcyksXG4gICAgKTtcblxuICAgIGNvbnN0IG5vdyA9IG5ld1RpbWU7XG4gICAgY29uc3QgdGltZUVsYXBzZWQgPSBub3cgLSB0aGlzLmxhc3RUaW1lO1xuXG4gICAgaWYgKHRpbWVFbGFwc2VkID4gdGhpcy5mcHNJbnRlcnZhbCkge1xuICAgICAgdGhpcy5sYXN0VGltZSA9IG5vdyAtICh0aW1lRWxhcHNlZCAlIHRoaXMuZnBzSW50ZXJ2YWwpO1xuICAgICAgY29uc3QgdGltZVNpbmNlU3RhcnQgPSBub3cgLSB0aGlzLnN0YXJ0VGltZTtcblxuICAgICAgdGhpcy5tb3ZlSW5EaXJlY3Rpb24oKTtcbiAgICAgIHRoaXMucGFpbnQoKTtcbiAgICAgIHRoaXMuZHJhd0ZQUyh0aW1lU2luY2VTdGFydCk7XG4gICAgICB0aGlzLnNob3dHYW1lTWVzc2FnZSgpO1xuICAgIH1cbiAgfVxuXG4gIGNoZWNrU3RhdGUocG9zaXRpb246IFBvc2l0aW9uKTogYm9vbGVhbiB7XG4gICAgY29uc3QgeyB4LCB5IH0gPSBwb3NpdGlvbjtcblxuICAgIGlmICh0aGlzLnBsYXllcklzQ29sbGlkZWRXaXRoVHJhcCh7IHgsIHkgfSkpIHtcbiAgICAgIHRoaXMubG9zdEdhbWUoKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBsZXQgY29sbGlkZWRBcHBsZSA9IHRoaXMucGxheWVySXNDb2xsaWRlZFdpdGhBcHBsZSh7IHgsIHkgfSk7XG4gICAgaWYgKGNvbGxpZGVkQXBwbGUpIHtcbiAgICAgIGNvbnN0IGlkeCA9IHRoaXMuYXBwbGVzLmluZGV4T2YoY29sbGlkZWRBcHBsZSk7XG4gICAgICB0aGlzLnBsYXllci5lYXQoY29sbGlkZWRBcHBsZS5ibG9jayk7XG4gICAgICB0aGlzLmFwcGxlcyA9IFtcbiAgICAgICAgLi4udGhpcy5hcHBsZXMuc2xpY2UoMCwgaWR4KSxcbiAgICAgICAgLi4udGhpcy5hcHBsZXMuc2xpY2UoaWR4ICsgMSksXG4gICAgICBdO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGNvbnN0IGNvbGxpZGVkV2l0aFNlbGYgPSB0aGlzLnBsYXllci5kZXRlY3RDb2xsaXNpb25XaXRoU2VsZihwb3NpdGlvbik7XG4gICAgaWYgKGNvbGxpZGVkV2l0aFNlbGYpIHtcbiAgICAgIGNvbnNvbGUubG9nKHsgcG9zaXRpb24sIGhlYWRCbG9jazogdGhpcy5wbGF5ZXIuaGVhZEJsb2NrLnBvc2l0aW9uIH0pO1xuICAgICAgdGhpcy5sb3N0R2FtZSgpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmFwcGxlcy5sZW5ndGggPT0gMCkge1xuICAgICAgdGhpcy5pc1J1bm5pbmcgPSBmYWxzZTtcbiAgICAgIHRoaXMuZ2FtZVN0YXR1cyA9IFwid29uXCI7XG4gICAgICB3aW5kb3cuY2FuY2VsQW5pbWF0aW9uRnJhbWUodGhpcy5hbmltYXRpb25GcmFtZVJlcXVlc3RJZCk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICBsb3N0R2FtZSgpIHtcbiAgICB0aGlzLmlzUnVubmluZyA9IGZhbHNlO1xuICAgIHRoaXMuZ2FtZVN0YXR1cyA9IFwibG9zdFwiO1xuICAgIHdpbmRvdy5jYW5jZWxBbmltYXRpb25GcmFtZSh0aGlzLmFuaW1hdGlvbkZyYW1lUmVxdWVzdElkKTtcbiAgfVxuXG4gIHBsYXllcklzQ29sbGlkZWRXaXRoVHJhcCh7IHgsIHkgfSkge1xuICAgIHJldHVybiB0aGlzLnRyYXBzLnNvbWUoKHRyYXApID0+IHtcbiAgICAgIHJldHVybiB0cmFwLmRldGVjdENvbGxpc2lvbih7IHgsIHkgfSk7XG4gICAgfSk7XG4gIH1cblxuICBwbGF5ZXJJc0NvbGxpZGVkV2l0aEFwcGxlKHsgeCwgeSB9KSB7XG4gICAgcmV0dXJuIHRoaXMuYXBwbGVzLmZpbmQoKGFwcGxlKSA9PiB7XG4gICAgICByZXR1cm4gYXBwbGUuZGV0ZWN0Q29sbGlzaW9uKHsgeCwgeSB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIGdldCBjb250ZXh0KCk6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCB7XG4gICAgcmV0dXJuIHRoaXMuY2FudmFzLmdldENvbnRleHQoXCIyZFwiKTtcbiAgfVxuXG4gIHBhaW50KCkge1xuICAgIHRoaXMuY2xlYXJTY3JlZW4oKTtcbiAgICB0aGlzLmRyYXdHcmlkKDAsIDAsIHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0KTtcbiAgICB0aGlzLmRyYXdTcHJpdGUodGhpcy5wbGF5ZXIpO1xuICAgIHRoaXMuYXBwbGVzLmZvckVhY2goKGFwcGxlKSA9PiB0aGlzLmRyYXdTcHJpdGUoYXBwbGUpKTtcbiAgICB0aGlzLnRyYXBzLmZvckVhY2goKHRyYXApID0+IHRoaXMuZHJhd1Nwcml0ZSh0cmFwKSk7XG4gIH1cblxuICBjbGVhclNjcmVlbigpIHtcbiAgICB0aGlzLmNvbnRleHQuZmlsbFN0eWxlID0gXCJ3aGl0ZVwiO1xuICAgIHRoaXMuY29udGV4dC5jbGVhclJlY3QoMCwgMCwgdGhpcy53aWR0aCwgdGhpcy5oZWlnaHQpO1xuICB9XG5cbiAgZHJhd1Nwcml0ZShzcHJpdGU6IFNwcml0ZSkge1xuICAgIHNwcml0ZS5ibG9ja3MuZm9yRWFjaCgoYmxvY2spID0+IHtcbiAgICAgIHRoaXMuZHJhd0Jsb2NrKGJsb2NrLnBvc2l0aW9uLngsIGJsb2NrLnBvc2l0aW9uLnksIGJsb2NrLmNvbG9yKTtcbiAgICB9KTtcbiAgfVxuXG4gIGRyYXdCbG9jayh4OiBudW1iZXIsIHk6IG51bWJlciwgY29sb3I6IHN0cmluZykge1xuICAgIHRoaXMuY29udGV4dC5maWxsU3R5bGUgPSBjb2xvcjtcbiAgICB0aGlzLmNvbnRleHQuZmlsbFJlY3QoXG4gICAgICB4ICogdGhpcy5jZWxsU2l6ZSxcbiAgICAgIHkgKiB0aGlzLmNlbGxTaXplLFxuICAgICAgdGhpcy5jZWxsU2l6ZSxcbiAgICAgIHRoaXMuY2VsbFNpemUsXG4gICAgKTtcbiAgfVxuXG4gIGRyYXdHcmlkKHg6IG51bWJlciwgeTogbnVtYmVyLCB3aWR0aDogbnVtYmVyLCBoZWlnaHQ6IG51bWJlcikge1xuICAgIHRoaXMuY29udGV4dC5zdHJva2VTdHlsZSA9IFwiI0NDQ0NDQ1wiO1xuICAgIGZvciAobGV0IHggPSAwOyB4IDw9IHdpZHRoOyB4ICs9IHRoaXMuY2VsbFNpemUpIHtcbiAgICAgIHRoaXMuY29udGV4dC5iZWdpblBhdGgoKTtcbiAgICAgIHRoaXMuY29udGV4dC5tb3ZlVG8oeCwgeSk7XG4gICAgICB0aGlzLmNvbnRleHQubGluZVRvKHgsIGhlaWdodCk7XG4gICAgICB0aGlzLmNvbnRleHQuc3Ryb2tlKCk7XG4gICAgfVxuXG4gICAgZm9yIChsZXQgeSA9IDA7IHkgPD0gaGVpZ2h0OyB5ICs9IHRoaXMuY2VsbFNpemUpIHtcbiAgICAgIHRoaXMuY29udGV4dC5iZWdpblBhdGgoKTtcbiAgICAgIHRoaXMuY29udGV4dC5tb3ZlVG8oeCwgeSk7XG4gICAgICB0aGlzLmNvbnRleHQubGluZVRvKHdpZHRoLCB5KTtcbiAgICAgIHRoaXMuY29udGV4dC5zdHJva2UoKTtcbiAgICB9XG4gIH1cblxuICBzaG93R2FtZU1lc3NhZ2UoKSB7XG4gICAgc3dpdGNoICh0aGlzLmdhbWVTdGF0dXMpIHtcbiAgICAgIGNhc2UgXCJsb3N0XCI6XG4gICAgICAgIHRoaXMuZHJhd1RleHRBdE1pZGRsZShcIlRyeSBhZ2FpblwiKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwid29uXCI6XG4gICAgICAgIHRoaXMuZHJhd1RleHRBdE1pZGRsZShcIllvdSB3b24hXCIpO1xuICAgICAgICBicmVhaztcbiAgICB9XG4gIH1cblxuICBkcmF3RlBTKHRpbWVTaW5jZVN0YXJ0OiBudW1iZXIpIHtcbiAgICBjb25zdCBjdXJyZW50RnBzID1cbiAgICAgIE1hdGgucm91bmQoKDEwMDAgLyAodGltZVNpbmNlU3RhcnQgLyArK3RoaXMuZnJhbWVDb3VudCkpICogMTAwKSAvIDEwMDtcbiAgICB0aGlzLmRyYXdUZXh0QXRCb3R0b21SaWdodChgRlBTOiAke2N1cnJlbnRGcHMudG9TdHJpbmcoKX1gKTtcbiAgfVxuXG4gIGRyYXdTdHJva2VUZXh0KHRleHQ6IHN0cmluZywgeDogbnVtYmVyLCB5OiBudW1iZXIpIHtcbiAgICB0aGlzLmNvbnRleHQuc3Ryb2tlU3R5bGUgPSBcIndoaXRlXCI7XG4gICAgY29uc3QgcHJldkxpbmVXaWR0aCA9IHRoaXMuY29udGV4dC5saW5lV2lkdGg7XG4gICAgdGhpcy5jb250ZXh0LmxpbmVXaWR0aCA9IDQ7XG4gICAgdGhpcy5jb250ZXh0LnN0cm9rZVRleHQodGV4dCwgeCwgeSk7XG4gICAgdGhpcy5jb250ZXh0LmZpbGxTdHlsZSA9IFwiYmxhY2tcIjtcbiAgICB0aGlzLmNvbnRleHQuZmlsbFRleHQodGV4dCwgeCwgeSk7XG4gICAgdGhpcy5jb250ZXh0LmxpbmVXaWR0aCA9IHByZXZMaW5lV2lkdGg7XG4gIH1cblxuICBkcmF3VGV4dEF0TWlkZGxlKHRleHQ6IHN0cmluZykge1xuICAgIHRoaXMuY29udGV4dC5mb250ID0gXCIzNnB4IHNhbnMtc2VyaWZcIjtcblxuICAgIGNvbnN0IHRleHRNZXRyaWNzID0gdGhpcy5jb250ZXh0Lm1lYXN1cmVUZXh0KHRleHQpO1xuICAgIHRoaXMuZHJhd1N0cm9rZVRleHQoXG4gICAgICB0ZXh0LFxuICAgICAgdGhpcy53aWR0aCAvIDIgLSB0ZXh0TWV0cmljcy53aWR0aCAvIDIsXG4gICAgICB0aGlzLmhlaWdodCAvIDIgLSB0ZXh0TWV0cmljcy5hY3R1YWxCb3VuZGluZ0JveEFzY2VudCAvIDIsXG4gICAgKTtcbiAgfVxuXG4gIGRyYXdUZXh0QXRCb3R0b21SaWdodCh0ZXh0OiBzdHJpbmcpIHtcbiAgICB0aGlzLmNvbnRleHQuZm9udCA9IFwiMTJweCBzYW5zLXNlcmlmXCI7XG5cbiAgICBjb25zdCB0ZXh0TWV0cmljcyA9IHRoaXMuY29udGV4dC5tZWFzdXJlVGV4dCh0ZXh0KTtcbiAgICB0aGlzLmRyYXdUZXh0KHRleHQsIHRoaXMud2lkdGggLSB0ZXh0TWV0cmljcy53aWR0aCAtIDEsIHRoaXMuaGVpZ2h0IC0gMik7XG4gIH1cblxuICBkcmF3VGV4dCh0ZXh0OiBzdHJpbmcsIHg6IG51bWJlciwgeTogbnVtYmVyKSB7XG4gICAgdGhpcy5jb250ZXh0LmZpbGxTdHlsZSA9IFwiYmxhY2tcIjtcblxuICAgIHRoaXMuY29udGV4dC5maWxsVGV4dCh0ZXh0LCB4LCB5LCB0aGlzLndpZHRoKTtcbiAgfVxuXG4gIHNldFNuYWtlUG9zaXRpb24oKSB7XG4gICAgY29uc3QgW21pZGRsZVgsIG1pZGRsZVldID0gW1xuICAgICAgTWF0aC5mbG9vcih0aGlzLmNlbGxzWCAvIDIpLFxuICAgICAgTWF0aC5mbG9vcih0aGlzLmNlbGxzWSAvIDIpLFxuICAgIF07XG4gICAgdGhpcy5wbGF5ZXIgPSBuZXcgUGxheWVyKHsgeDogbWlkZGxlWCwgeTogbWlkZGxlWSB9LCA2KTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0UmFuZG9tWFkoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHg6IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIHRoaXMuY2VsbHNYKSxcbiAgICAgIHk6IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIHRoaXMuY2VsbHNZKSxcbiAgICB9O1xuICB9XG5cbiAgc2V0QXBwbGVQb3NpdGlvbnMoKSB7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLm51bUFwcGxlczsgaSsrKSB7XG4gICAgICBsZXQgYXBwbGU6IEFwcGxlO1xuICAgICAgd2hpbGUgKCFhcHBsZSB8fCBhcHBsZS5kZXRlY3RDb2xsaXNpb25XaXRoU3ByaXRlKHRoaXMucGxheWVyKSkge1xuICAgICAgICBjb25zdCB7IHgsIHkgfSA9IHRoaXMuZ2V0UmFuZG9tWFkoKTtcbiAgICAgICAgYXBwbGUgPSBuZXcgQXBwbGUoeyB4LCB5IH0pO1xuICAgICAgfVxuICAgICAgdGhpcy5hcHBsZXMucHVzaChhcHBsZSk7XG4gICAgfVxuICB9XG5cbiAgc2V0VHJhcFBvc2l0aW9ucygpIHtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMubnVtVHJhcHM7IGkrKykge1xuICAgICAgbGV0IHRyYXA6IFRyYXA7XG4gICAgICB3aGlsZSAoXG4gICAgICAgICF0cmFwIHx8XG4gICAgICAgIHRyYXAuZGV0ZWN0Q29sbGlzaW9uV2l0aFNwcml0ZSh0aGlzLnBsYXllcikgfHxcbiAgICAgICAgdGhpcy5hcHBsZXMuc29tZSgoYXBwbGUpID0+IGFwcGxlLmRldGVjdENvbGxpc2lvbldpdGhTcHJpdGUodHJhcCkpXG4gICAgICApIHtcbiAgICAgICAgY29uc3QgeyB4LCB5IH0gPSB0aGlzLmdldFJhbmRvbVhZKCk7XG4gICAgICAgIHRyYXAgPSBuZXcgVHJhcCh7IHgsIHkgfSk7XG4gICAgICB9XG4gICAgICB0aGlzLnRyYXBzLnB1c2godHJhcCk7XG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IEdhbWU7XG4iLCJpbXBvcnQgR2FtZSBmcm9tICcuL2dhbWUnXG5cblxuY29uc3QgZ2FtZSA9IG5ldyBHYW1lKClcbmdhbWUucnVuR2FtZUxvb3AoKSIsIi8vIFRoZSBtb2R1bGUgY2FjaGVcbnZhciBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18gPSB7fTtcblxuLy8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbmZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG5cdGlmKF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF0pIHtcblx0XHRyZXR1cm4gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXS5leHBvcnRzO1xuXHR9XG5cdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG5cdHZhciBtb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdID0ge1xuXHRcdC8vIG5vIG1vZHVsZS5pZCBuZWVkZWRcblx0XHQvLyBubyBtb2R1bGUubG9hZGVkIG5lZWRlZFxuXHRcdGV4cG9ydHM6IHt9XG5cdH07XG5cblx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG5cdF9fd2VicGFja19tb2R1bGVzX19bbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG5cdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG5cdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbn1cblxuIiwiLy8gc3RhcnR1cFxuLy8gTG9hZCBlbnRyeSBtb2R1bGVcbi8vIFRoaXMgZW50cnkgbW9kdWxlIGlzIHJlZmVyZW5jZWQgYnkgb3RoZXIgbW9kdWxlcyBzbyBpdCBjYW4ndCBiZSBpbmxpbmVkXG5fX3dlYnBhY2tfcmVxdWlyZV9fKDYwNyk7XG4iXSwic291cmNlUm9vdCI6IiJ9